version: '3.8'

services:
  helm-deployer:
    image: dtzar/helm-kubectl:latest
    working_dir: /workdir
    volumes:
      - .:/workdir
    environment:
      - AWS_DEFAULT_REGION=us-east-1
    command: |
      bash -c "
        # Install AWS CLI (container has kubectl and helm pre-installed)
        apk add --no-cache aws-cli
        
        # Configure kubectl for EKS cluster
        aws eks update-kubeconfig --region us-east-1 --name ola-bk-test
        
        # Verify tools are available
        echo 'âœ… Verifying tools...'
        helm version
        kubectl version --client
        kubectl get nodes
        
        echo 'ðŸš€ Docker Compose deployment completed'
      "
