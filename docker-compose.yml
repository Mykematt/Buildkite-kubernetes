version: '3.8'
services:
  helm-deployer:
    image: 097340723131.dkr.ecr.us-east-1.amazonaws.com/buildkite-multi-tool:latest
    volumes:
      - ~/.aws:/root/.aws:ro
      - ~/.kube:/root/.kube:ro
    environment:
      - AWS_REGION=us-east-1
    working_dir: /workdir
    command: |
      sh -c "
      # Verify all tools are available (no installation needed)
      aws --version
      kubectl version --client
      helm version
      
      # Configure kubectl for EKS cluster using IAM role authentication
      aws eks update-kubeconfig --region us-east-1 --name ola-buildkite-cluster
      
      echo 'Docker Compose plugin deployment completed'
      sleep 300
      "
