steps:
  - label: "Deploy Nginx to Kubernetes"
    command: |
      kubectl apply -f ../k8s/
      echo "\nWaiting for deployment to be ready..."
      kubectl rollout status deployment/nginx-deployment
    agents:
      queue: kubernetes
    plugins:
      - kubernetes:
          podSpec:
            containers:
              - image: k8s.gcr.io/kubectl:v1.28.0
                command: ["/bin/sh", "-c"]
                args: ["kubectl apply -f ../k8s/ && echo '\nWaiting for deployment to be ready...' && kubectl rollout status deployment/nginx-deployment"]
                volumeMounts:
                  - name: k8s-config
                    mountPath: /root/.kube
            volumes:
              - name: k8s-config
                hostPath:
                  path: /root/.kube
                  type: Directory
